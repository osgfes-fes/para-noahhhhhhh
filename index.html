<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Galaxia para ti</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
#galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
.pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;font:12px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
.attribution{position:fixed;left:10px;bottom:10px;font-size:11px;color:#b9a0ff;opacity:.8;background:rgba(0,0,0,.35);padding:6px 8px;border-radius:8px}
.player{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;background:rgba(20,15,35,.35);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:8px;color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
.player button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;cursor:pointer}
#fx{position:fixed;inset:0;pointer-events:none}
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Muchote Mis Ojitos BrillantesðŸ’›</div>
<div class="attribution">Base: tlanex Â· AdaptaciÃ³n para Jotab ðŸ’«</div>

<div class="player">
  <button id="playBtn">â–¶ï¸Ž Reproducir MÃºsica</button>
  <audio id="audio" preload="auto">
    <source src="cancion.mp3" type="audio/mpeg">
  </audio>
</div>

<canvas id="fx"></canvas>

<script>
(function(){
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');

// BotÃ³n de reproducciÃ³n
playBtn.addEventListener('click', ()=>{
  if(audio.paused){
    audio.play().then(()=>playBtn.textContent='â¸ï¸Ž Pausar')
    .catch(()=>alert('No se pudo reproducir la mÃºsica. Revisa el archivo cancion.mp3'));
  } else {
    audio.pause();
    playBtn.textContent='â–¶ï¸Ž Reproducir MÃºsica';
  }
});

// ====== THREE.JS GALAXY ======
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.06;
controls.minDistance = 10; controls.maxDistance = 220;
controls.target.set(0,0,0);

// CÃ¡mara inicial
camera.position.set(0,22,75);

// Estrellas bÃ¡sicas
const starCount = 8000;
const geom = new THREE.BufferGeometry();
const positions = new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){
  const dist = Math.random()*82*1.15;
  const ang = Math.random()*Math.PI*2;
  const y = (Math.random()-0.5)*36*Math.pow(1-Math.min(dist,82)/82,1.5);
  positions[i*3] = Math.cos(ang)*dist;
  positions[i*3+1] = y;
  positions[i*3+2] = Math.sin(ang)*dist;
}
geom.setAttribute('position', new THREE.BufferAttribute(positions,3));
const stars = new THREE.Points(geom, new THREE.PointsMaterial({ color:0xffffff, size:0.28, transparent:true, opacity:0.65, blending:THREE.AdditiveBlending }));
scene.add(stars);

// Frases (simplificadas)
const phrases = ["Pinchecha âœ¨","Hermosa ðŸ’›","Mi Bebe","Mi Cielito ðŸŒŒ","Te AmoðŸ’›"];
phrases.forEach((txt,i)=>{
  const c = document.createElement('canvas'); c.width=512; c.height=64;
  const g = c.getContext('2d');
  g.font='bold 24px Arial'; g.fillStyle='white'; g.textAlign='center'; g.textBaseline='middle';
  g.fillText(txt,256,32);
  const tex = new THREE.CanvasTexture(c);
  const spr = new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true }));
  spr.position.set((Math.random()-0.5)*60,(Math.random()-0.5)*20,(Math.random()-0.5)*60);
  spr.scale.set(10,2.5,1);
  scene.add(spr);
});

// AnimaciÃ³n
function animate(){
  requestAnimationFrame(animate);
  stars.rotation.y += 0.0005;
  controls.update();
  renderer.render(scene,camera);
}
animate();

// Corazones overlay
const fx = document.getElementById('fx');
const ctx2 = fx.getContext('2d');
fx.width = window.innerWidth*2; fx.height = window.innerHeight*2;
fx.style.width = window.innerWidth+'px'; fx.style.height = window.innerHeight+'px';
const hearts=[];
let lastTap=0;
addEventListener('click', (e)=>{
  const now=performance.now();
  if(now-lastTap<320) {
    for(let i=0;i<20;i++){
      const a=Math.random()*Math.PI*2;
      hearts.push({x:e.clientX*2,y:e.clientY*2,vx:Math.cos(a)*1,vy:-Math.random()*1.5,life:1,size:8+Math.random()*10});
    }
  }
  lastTap=now;
});
function loopFx(){
  ctx2.clearRect(0,0,fx.width,fx.height);
  for(let i=hearts.length-1;i>=0;i--){
    const h = hearts[i]; h.x+=h.vx; h.y+=h.vy; h.vy-=0.02; h.life-=0.02;
    ctx2.globalAlpha = Math.max(0,h.life); 
    ctx2.save(); ctx2.translate(h.x,h.y);
    ctx2.beginPath(); ctx2.moveTo(0,-0.25*h.size);
    ctx2.bezierCurveTo(.5*h.size,-.9*h.size,1.4*h.size,-.1*h.size,0,.9*h.size);
    ctx2.bezierCurveTo(-1.4*h.size,-.1*h.size,-.5*h.size,-.9*h.size,0,-0.25*h.size);
    const g=ctx2.createRadialGradient(0,0,0,0,0,h.size);
    g.addColorStop(0,'rgba(255,190,220,.95)'); g.addColorStop(1,'rgba(255,90,160,0)');
    ctx2.fillStyle=g; ctx2.fill(); ctx2.restore();
    if(h.life<=0) hearts.splice(i,1);
  }
  requestAnimationFrame(loopFx);
}
loopFx();

// Resize
window.addEventListener('resize',()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
  fx.width = window.innerWidth*2; fx.height = window.innerHeight*2;
  fx.style.width = window.innerWidth+'px';
  fx.style.height = window.innerHeight+'px';
});
})();
</script>

</body>
</html>
