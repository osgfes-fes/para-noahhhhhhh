<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Galaxia para ti</title>
  <meta name="description" content="Galaxia interactiva de frases de cari√±o üíò">
  <meta property="og:title" content="Galaxia para ti">
  <meta property="og:description" content="Una galaxia interactiva con palabras de cari√±o üíñ">
  <meta property="og:image" content="og-cover.png">
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
    .attribution{position:fixed;left:10px;bottom:10px;font-size:11px;color:#b9a0ff;opacity:.8;background:rgba(0,0,0,.35);padding:6px 8px;border-radius:8px}
    .player{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;
             background:rgba(20,15,35,.35);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:8px;
             backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    .player button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;cursor:pointer}
    .player input[type=file]{display:none}
    .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
          background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;font:12px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    .error{position:fixed;inset:auto 10px 70px 10px;background:#260015;color:#ffd9f7;border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Muchote Mis Ojitos Brillantesüíõ</div>
<div class="attribution">Base: tlanex ¬∑ Adaptaci√≥n para Jotab üí´</div>
<div id="err" class="error"></div>

<div class="player">
  <button id="playBtn">‚ñ∂Ô∏é</button>
  <span style="font-size:12px;opacity:.9">Elije tu cancion  <b>cancion.mp3</b>Detalles Mr<b>üíôüåπ‚ô•Ô∏è</b> (Reproductor Mr‚Äù)</span>
  <input type="file" id="pickFile" accept="audio/*">
  <button id="pickBtn">Elegir canci√≥n</button>
  <audio id="audio" preload="auto">
    <source src="./cancion.mp3" type="audio/mpeg">
  </audio>
</div>

<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
(function(){
const err = document.getElementById('err');
function showError(msg){ err.textContent = msg; err.style.display='block'; }

// ====== AUDIO ======
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const pickBtn = document.getElementById('pickBtn');
const pickFile = document.getElementById('pickFile');

playBtn.onclick = async () => {
  try {
    if(audio.paused) { 
      await audio.play(); 
      playBtn.textContent='‚è∏Ô∏é'; 
    } else { 
      audio.pause(); 
      playBtn.textContent='‚ñ∂Ô∏é'; 
    }
  }
  catch(e){ showError('Si no suena, toca ‚ÄúElegir canci√≥n‚Äù y selecciona tu MP3.'); }
};
pickBtn.onclick = () => pickFile.click();
pickFile.onchange = () => {
  if (pickFile.files && pickFile.files[0]) {
    const url = URL.createObjectURL(pickFile.files[0]);
    audio.src = url; 
    audio.play().then(()=> playBtn.textContent='‚è∏Ô∏é').catch(()=>{});
  }
};

// --- AUTOPLAY tras primer click en p√°gina (para navegadores que bloquean autoplay) ---
document.addEventListener('click', () => {
  if(audio.paused) audio.play().catch(()=>{});
}, {once:true});

// ====== WEBGL CHECK ======
try { 
  const test = document.createElement('canvas').getContext('webgl') || document.createElement('canvas').getContext('experimental-webgl');
  if(!test) throw new Error('Tu navegador no tiene WebGL activo');
} catch(e) { showError('WebGL parece desactivado. Prueba con Chrome/Edge/Firefox, o habilita aceleraci√≥n por hardware.'); return; }

// ====== GALAXY ======
// Tu c√≥digo original de Three.js y galaxia sigue aqu√≠ exactamente igual
// ... (no se toca nada de tu galaxia)
})();
</script>
</body>
</html>
