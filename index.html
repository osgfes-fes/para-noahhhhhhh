<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galaxia para ti</title>
<style>
  html, body {margin:0; height:100%; background:#000; overflow:hidden; font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;}
  #galaxy-canvas {position:fixed; inset:0; width:100%; height:100%; display:block; touch-action:none;}
  .pill {position:fixed; top:10px; left:50%; transform:translateX(-50%); padding:6px 12px; border-radius:999px;
        background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18); color:#fff; font-size:12px;}
  .attribution {position:fixed; left:10px; bottom:10px; font-size:11px; color:#b9a0ff; opacity:.8; background:rgba(0,0,0,.35); padding:6px 8px; border-radius:8px;}
  .player {position:fixed; left:10px; bottom:50px; padding:10px 14px; background:rgba(20,15,35,.35); border-radius:12px; color:#fff;}
  .player button {padding:6px 12px; border-radius:10px; border:none; background:rgba(255,255,255,.08); color:#fff; cursor:pointer;}
  #fx {position:fixed; inset:0; pointer-events:none;}
</style>
<!-- Three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Muchote Mis Ojitos BrillantesðŸ’›</div>
<div class="attribution">Base: tlanex Â· AdaptaciÃ³n para Jotab ðŸ’«</div>

<div class="player">
  <button id="playBtn">â–¶ï¸Ž Reproducir MÃºsica</button>
  <audio id="audio" preload="auto">
    <source src="cancion.mp3" type="audio/mpeg">
  </audio>
</div>

<canvas id="fx"></canvas>

<script>
(function(){
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');

// BotÃ³n para reproducir/pausar mÃºsica
playBtn.addEventListener('click', () => {
    if(audio.paused){
        audio.play().then(()=>{ playBtn.textContent='â¸ï¸Ž Pausar'; })
        .catch(err => alert('No se pudo reproducir la mÃºsica. Revisa el archivo cancion.mp3'));
    } else {
        audio.pause();
        playBtn.textContent='â–¶ï¸Ž Reproducir MÃºsica';
    }
});
audio.addEventListener('ended', ()=>{ playBtn.textContent='â–¶ï¸Ž Reproducir MÃºsica'; });

// ====== THREE.JS GALAXY ======
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true; controls.dampingFactor = 0.06;

function setCam(){
  const w = window.innerWidth, h = window.innerHeight;
  const isMobile = w < 768 || w < h;
  camera.fov = isMobile ? 90 : 75;
  camera.position.set(0, isMobile?26:22, isMobile?110:75);
  camera.updateProjectionMatrix();
  controls.update();
}
setCam();

// ---------- Starfield ----------
function makeStarTexture(size=1024, count=2000){
  const c=document.createElement('canvas'); c.width=c.height=size;
  const g=c.getContext('2d');
  const r=size/2;
  const bg = g.createRadialGradient(r,r,r*0.2, r,r,r);
  bg.addColorStop(0,'#050010'); bg.addColorStop(1,'#000');
  g.fillStyle=bg; g.fillRect(0,0,size,size);
  for(let i=0;i<count;i++){
    const x=Math.random()*size, y=Math.random()*size;
    const base=Math.random()*0.7+0.3;
    const glow=g.createRadialGradient(x,y,0,x,y,Math.random()*2+1.6);
    const hue=Math.random();
    glow.addColorStop(0,'rgba(255,255,255,'+(0.65*base)+')');
    glow.addColorStop(1,hue<0.25?'rgba(255,180,240,'+(0.12*base)+')':'rgba(180,190,255,'+(0.12*base)+')');
    g.fillStyle=glow; g.beginPath(); g.arc(x,y,Math.random()*1.2+0.6,0,Math.PI*2); g.fill();
  }
  return new THREE.CanvasTexture(c);
}

const bgGeo = new THREE.SphereGeometry(600,64,64);
const starTex = makeStarTexture(1024,2600);
starTex.wrapS=starTex.wrapT=THREE.RepeatWrapping;
const bg = new THREE.Mesh(bgGeo, new THREE.MeshBasicMaterial({ map: starTex, side: THREE.BackSide, transparent:false, opacity:0.85 }));
scene.add(bg);

// Galaxy phrases
const galaxy = new THREE.Group(); scene.add(galaxy);
const phrases = ["Pinchecha âœ¨","Hermosa ðŸ’›","Mi Bebe","Mi Cielito ðŸŒŒ","Hermosota âœ¨","Te quiero mucho Noah ðŸ’œ","PequeÃ±a Noah âœ¨","Mi suport favorita ðŸŒŒ","Mi keria de Temu ðŸ«¶","Mi Infinita â™¾ï¸","Mi Todo","Me Encantas ðŸ¥°","Perla ðŸ’«","Te AmoðŸ’›","Mi CanciÃ³n Favorita ðŸŽ¶","Unica ðŸ˜Š","Mi Reina ðŸ‘‘","Mi Amor","Mi Mundo","Mi Luz ðŸŒ ","Mi NiÃ±a","Mi TesoroðŸ’›","Mi Paz","Mi Eterna","Mi SueÃ±o","Mi Pensamiento Favorito","Mi Bombom","Mi Diosa","Te Amo Infinitamente â™¾ï¸"];
const phraseCount = Math.max(phrases.length*6,180);
const arms = 5, radius = 82, maxH = 22;

function makeTextTexture(text,size=48){
  const c=document.createElement('canvas'); c.width=1024; c.height=128;
  const g=c.getContext('2d'); g.clearRect(0,0,c.width,c.height);
  g.font='800 '+size+'px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';
  g.textAlign='center'; g.textBaseline='middle';
  g.shadowColor='rgba(210,140,255,0.95)'; g.shadowBlur=24;
  g.fillStyle='rgba(255,240,255,0.98)'; g.fillText(text,c.width/2,c.height/2);
  return new THREE.CanvasTexture(c);
}

for(let i=0;i<phraseCount;i++){
  const text=phrases[i%phrases.length];
  const tex=makeTextTexture(text,48);
  const spr=new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true, depthWrite:false }));
  const perArm=phraseCount/arms;
  const ang=(i%perArm)*(Math.PI*2/perArm);
  const armAng=Math.floor(i/perArm)*(Math.PI*2/arms);
  const dist=Math.pow(i/phraseCount,0.72)*radius;
  const thickness=Math.pow(1-(dist/radius),2);
  spr.position.set(Math.cos(ang+armAng)*dist,(Math.random()-0.5)*maxH*thickness*.9, Math.sin(ang+armAng)*dist);
  spr.scale.set(20,2.6,1);
  galaxy.add(spr);
}

// Stars
const starCount=8000, geom=new THREE.BufferGeometry(), pos=new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){
  const ang=Math.random()*Math.PI*2, dist=Math.random()*radius*1.15;
  const y=(Math.random()-0.5)*36*Math.pow(1-Math.min(dist,radius)/radius,1.5);
  pos[i*3]=Math.cos(ang)*dist; pos[i*3+1]=y; pos[i*3+2]=Math.sin(ang)*dist;
}
geom.setAttribute('position',new THREE.BufferAttribute(pos,3));
galaxy.add(new THREE.Points(geom,new THREE.PointsMaterial({ color:0xffffff, size:0.28, transparent:true, opacity:0.65, blending:THREE.AdditiveBlending })));

// Animate
let tw=0;
function animate(){
  requestAnimationFrame(animate);
  const t=performance.now()*0.001;
  tw=(tw+0.0003)%1;
  starTex.offset.set(tw,0);
  galaxy.rotation.y=t*0.05;
  controls.update();
  renderer.render(scene,camera);
}
animate();

// ====== HEARTS FX ======
const fx=document.getElementById('fx');
const ctx2=fx.getContext('2d');
function resizeFx(){ fx.width=window.innerWidth*2; fx.height=window.innerHeight*2; fx.style.width=window.innerWidth+'px'; fx.style.height=window.innerHeight+'px'; }
addEventListener('resize',resizeFx); resizeFx();
const hearts=[];
function spawnHearts(x,y,n=20){
  for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2;
    hearts.push({x:x*2, y:y*2, vx:Math.cos(a)*(0.6+Math.random()*0.8), vy:-(0.8+Math.random()*1.2), life:1, size:10+Math.random()*16});
  }
}
function drawHeart(x,y,size){
  const s=size; ctx2.save(); ctx2.translate(x,y);
  ctx2.beginPath(); ctx2.moveTo(0,-0.25*s);
  ctx2.bezierCurveTo(.5*s,-.9*s,1.4*s,-.1*s,0,.9*s);
  ctx2.bezierCurveTo(-1.4*s,-.1*s,-.5*s,-.9*s,0,-.25*s);
  const g=ctx2.createRadialGradient(0,0,0,0,0,s);
  g.addColorStop(0,'rgba(255,190,220,.95)'); g.addColorStop(1,'rgba(255,90,160,0)');
  ctx2.fillStyle=g; ctx2.fill(); ctx2.restore();
}
let lastTap=0;
addEventListener('click', (e)=>{ const now=performance.now(); if(now-lastTap<320) spawnHearts(e.clientX,e.clientY,20); lastTap=now; },{passive:true});
addEventListener('touchend', (e)=>{ const now=performance.now(); const t=e.changedTouches&&e.changedTouches[0]; if(now-lastTap<320&&t) spawnHearts(t.clientX,t.clientY,20); lastTap=now; },{passive:true});
function loopFx(){ ctx2.clearRect(0,0,fx.width,fx.height); for(let i=hearts.length-1;i>=0;i--){ const h=hearts[i]; h.x+=h.vx; h.y+=h.vy; h.vy-=0.02; h.life-=0.015; ctx2.globalAlpha=Math.max(0,h.life); drawHeart(h.x,h.y,h.size); ctx2.globalAlpha=1; if(h.life<=0) hearts.splice(i,1);} requestAnimationFrame(loopFx); }
loopFx();

})();
</script>
</body>
</html>
